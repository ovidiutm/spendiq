export type Language = 'en' | 'ro' | 'fr' | 'it' | 'de'
type InterpolationValues = Record<string, string | number>

export function normalizeLanguage(raw: string | null | undefined): Language {
  switch (String(raw ?? '').toLowerCase()) {
    case 'ro':
      return 'ro'
    case 'fr':
      return 'fr'
    case 'it':
      return 'it'
    case 'de':
      return 'de'
    default:
      return 'en'
  }
}

type NonPrimaryLanguage = Exclude<Language, 'en' | 'ro'>

type TranslationCatalog = Record<NonPrimaryLanguage, Record<string, string>>

const TRANSLATIONS: TranslationCatalog = {
  fr: {
    'Mode Selection': 'Selection du mode',
    'Anonymous': 'Anonyme',
    'User Account': 'Compte utilisateur',
    'Dashboard': 'Tableau de bord',
    'User Login': 'Connexion utilisateur',
    'Checking session...': 'Verification de session...',
    'Signed in: ': 'Connecte: ',
    'Logout': 'Se deconnecter',
    'Login / Register': 'Connexion / Inscription',
    'Email / Username': 'E-mail / Nom utilisateur',
    'Password': 'Mot de passe',
    'Show password': 'Afficher le mot de passe',
    'Hide password': 'Masquer le mot de passe',
    'Login': 'Connexion',
    'Register': 'Inscription',
    'Loading...': 'Chargement...',
    'Applying selected language...': 'Application de la langue selectionnee...',
    'Continue as Anonymous': 'Continuer en anonyme',
    'Continue with User Account': 'Continuer avec un compte utilisateur',
    'Login Required for Account Mode': 'Connexion requise pour le mode compte',
    'Import Bank Statement': 'Importer un releve bancaire',
    'Building dashboard...': 'Creation du tableau de bord...',
    'Reload View': 'Recharger la vue',
    'Close notification': 'Fermer la notification',
    'Account Statement Details': 'Details du releve de compte',
    'Account Holder': 'Titulaire du compte',
    'Account Number': 'Numero de compte',
    'Account Type': 'Type de compte',
    'Statement Period': 'Periode du releve',
    'Categories': 'Categories',
    'Expenses (debits)': 'Depenses (debits)',
    'Income (credits)': 'Revenus (credits)',
    'All': 'Tout',
    'All categories': 'Toutes les categories',
    'Add/Remove/Edit Category': 'Ajouter/Supprimer/Modifier une categorie',
    'Reset Categories to initial/default name values': 'Reinitialiser les categories aux valeurs par defaut',
    'Legend': 'Legende',
    'No category data for current filters.': 'Aucune donnee de categorie pour les filtres actuels.',
    'Top Merchants': 'Top commercants',
    'Search merchant / type...': 'Rechercher commercant / type...',
    'No merchant data.': 'Aucune donnee commercant.',
    'Balance Overview': 'Apercu du solde',
    'Net difference:': 'Difference nette:',
    'Savings net:': 'Epargne nette:',
    'Add savings account': 'Ajouter un compte epargne',
    'Transactions': 'Transactions',
    'Hover any row to see full transaction details from the PDF.': 'Survolez une ligne pour voir les details complets depuis le PDF.',
    'Filter table...': 'Filtrer le tableau...',
    'All columns': 'Toutes les colonnes',
    'Date': 'Date',
    'Merchant': 'Commercant',
    'Type': 'Type',
    'Category': 'Categorie',
    'Amount': 'Montant',
    'Save category for:': 'Enregistrer la categorie pour:',
    'Merchant + Type': 'Commercant + Type',
    'Single Transaction': 'Transaction unique',
    'Amount Sum': 'Somme des montants',
    'Export CSV (filtered)': 'Exporter CSV (filtre)',
    'Add / Edit category': 'Ajouter / Modifier categorie',
    'New category name...': 'Nouveau nom de categorie...',
    'Add': 'Ajouter',
    'Select a category...': 'Selectionner une categorie...',
    'Rename': 'Renommer',
    'Delete': 'Supprimer',
    'Save': 'Enregistrer',
    'Cancel': 'Annuler',
    'Savings Accounts': 'Comptes epargne',
    'Savings account IBAN': 'IBAN compte epargne',
    'No savings accounts added.': 'Aucun compte epargne ajoute.',
    'In': 'Entrees',
    'Out': 'Sorties',
    'Direction': 'Direction',
    'Expenses': 'Depenses',
    'Income': 'Revenus',
    'Savings': 'Epargne',
    'Expenses Transactions': 'Transactions depenses',
    'Income Transactions': 'Transactions revenus',
    'Savings Net (Configured accounts)': 'Epargne nette (comptes configures)',
    'Savings Flow': 'Flux epargne',
    'Savings In': 'Epargne entree',
    'Savings Out': 'Epargne sortie',
    'Total': 'Total',
    'Unknown error': 'Erreur inconnue',
    'Please login to save account data.': 'Veuillez vous connecter pour enregistrer les donnees du compte.',
    'Authentication failed.': 'Authentification echouee.',
    'Email/Username is required.': 'Email/Nom utilisateur requis.',
    'Password is required.': 'Mot de passe requis.',
    'This Email/Username is already used.': 'Cet email/nom utilisateur est deja utilise.',
    'Password should have at least 8 characters': 'Le mot de passe doit contenir au moins 8 caracteres',
    'Invalid Email/Username or Password.': 'Email/Nom utilisateur ou mot de passe invalide.',
    'Signed out. Running in anonymous local mode.': 'Deconnecte. Mode anonyme local actif.',
    'Signed out from user account.': 'Deconnecte du compte utilisateur.',
    'Logout failed.': 'Deconnexion echouee.',
    'WARNING! You will lose all changes made to transaction categories!\nReset Categories to initial/default values?': 'ATTENTION! Vous perdrez toutes les modifications des categories de transactions!\nReinitialiser les categories aux valeurs par defaut?',
    'Please login to reset categories in account mode.': 'Veuillez vous connecter pour reinitialiser les categories en mode compte.',
    'Categories reset to default values.': 'Categories reinitialisees aux valeurs par defaut.',
    'Reset failed.': 'Reinitialisation echouee.',
    'Reload failed.': 'Rechargement echoue.',
    'Save settings failed.': 'Echec de l enregistrement des parametres.',
    'Failed to load account data.': 'Echec du chargement des donnees du compte.',
    'Please login first to use User Account mode.': 'Veuillez vous connecter d abord pour utiliser le mode compte utilisateur.',
    'Works immediately with no account. Categories and overrides are saved only in this browser/device using local storage.': 'Fonctionne immediatement sans compte. Les categories et surcharges sont sauvegardees localement dans ce navigateur/appareil.',
    'Sign in to store categories and merchant/type overrides per account in the database, synced across sessions.': 'Connectez-vous pour stocker les categories et surcharges commercant/type par compte dans la base, synchronisees entre sessions.',
    'Automatically turn any account statement into an interactive financial dashboard with full control for organizing, filtering, and interpreting transactions, a clear Income vs. Expenses balance, plus configurable savings details.': 'Transformez automatiquement tout releve de compte en tableau de bord financier interactif avec controle complet pour organiser, filtrer et interpreter les transactions, un equilibre clair Revenus vs Depenses, et des details d epargne configurables.',
    'V1.1 - Anonymous mode uses local cache. Signed-in mode stores categories and overrides per account.': 'V1.1 - Le mode anonyme utilise le cache local. Le mode connecte stocke les categories et surcharges par compte.',
    'Upload a statement to see your dashboard.': 'Importez un releve pour voir votre tableau de bord.',
    'No transactions found for this view.': 'Aucune transaction trouvee pour cette vue.',
    'Set category per merchant + type': 'Definir categorie par commercant + type',
    'Set category only for this transaction': 'Definir categorie uniquement pour cette transaction',
    'Merchant + Type: changing one row applies category to all transactions with same Merchant and Type.': 'Commercant + Type: changer une ligne applique la categorie a toutes les transactions avec le meme commercant et type.',
    'Single Transaction: changing one row applies category only to that exact transaction.': 'Transaction unique: changer une ligne applique la categorie uniquement a cette transaction.',
    'Changing one row applies category to all transactions with same Merchant and Type.': 'Changer une ligne applique la categorie a toutes les transactions avec le meme commercant et type.',
    'Changing one row applies category only to that exact transaction.': 'Changer une ligne applique la categorie uniquement a cette transaction.',
    'Full transaction details included': 'Details complets de transaction inclus',
    'Done. Dashboard reloaded successfully.': 'Termine. Tableau de bord recharge avec succes.',
    'Net': 'Net',
  },
  it: {
    'Mode Selection': 'Selezione modalita',
    'Anonymous': 'Anonimo',
    'User Account': 'Account utente',
    'Dashboard': 'Dashboard',
    'User Login': 'Accesso utente',
    'Checking session...': 'Verifica sessione...',
    'Signed in: ': 'Connesso: ',
    'Logout': 'Disconnetti',
    'Login / Register': 'Accesso / Registrazione',
    'Email / Username': 'Email / Nome utente',
    'Password': 'Password',
    'Show password': 'Mostra password',
    'Hide password': 'Nascondi password',
    'Login': 'Accedi',
    'Register': 'Registrati',
    'Loading...': 'Caricamento...',
    'Applying selected language...': 'Applicazione lingua selezionata...',
    'Continue as Anonymous': 'Continua come anonimo',
    'Continue with User Account': 'Continua con account utente',
    'Login Required for Account Mode': 'Accesso richiesto per modalita account',
    'Import Bank Statement': 'Importa estratto conto',
    'Building dashboard...': 'Creazione dashboard...',
    'Reload View': 'Ricarica vista',
    'Close notification': 'Chiudi notifica',
    'Account Statement Details': 'Dettagli estratto conto',
    'Account Holder': 'Intestatario conto',
    'Account Number': 'Numero conto',
    'Account Type': 'Tipo conto',
    'Statement Period': 'Periodo estratto',
    'Categories': 'Categorie',
    'Expenses (debits)': 'Spese (addebiti)',
    'Income (credits)': 'Entrate (accrediti)',
    'All': 'Tutte',
    'All categories': 'Tutte le categorie',
    'Add/Remove/Edit Category': 'Aggiungi/Rimuovi/Modifica categoria',
    'Reset Categories to initial/default name values': 'Ripristina categorie ai valori predefiniti',
    'Legend': 'Legenda',
    'No category data for current filters.': 'Nessun dato categoria per i filtri correnti.',
    'Top Merchants': 'Top esercenti',
    'Search merchant / type...': 'Cerca esercente / tipo...',
    'No merchant data.': 'Nessun dato esercente.',
    'Balance Overview': 'Panoramica bilancio',
    'Net difference:': 'Differenza netta:',
    'Savings net:': 'Risparmio netto:',
    'Add savings account': 'Aggiungi conto risparmio',
    'Transactions': 'Transazioni',
    'Hover any row to see full transaction details from the PDF.': 'Passa il mouse su una riga per vedere tutti i dettagli dal PDF.',
    'Filter table...': 'Filtra tabella...',
    'All columns': 'Tutte le colonne',
    'Date': 'Data',
    'Merchant': 'Esercente',
    'Type': 'Tipo',
    'Category': 'Categoria',
    'Amount': 'Importo',
    'Save category for:': 'Salva categoria per:',
    'Merchant + Type': 'Esercente + Tipo',
    'Single Transaction': 'Transazione singola',
    'Amount Sum': 'Somma importi',
    'Export CSV (filtered)': 'Esporta CSV (filtrato)',
    'Add / Edit category': 'Aggiungi / Modifica categoria',
    'New category name...': 'Nuovo nome categoria...',
    'Add': 'Aggiungi',
    'Select a category...': 'Seleziona una categoria...',
    'Rename': 'Rinomina',
    'Delete': 'Elimina',
    'Save': 'Salva',
    'Cancel': 'Annulla',
    'Savings Accounts': 'Conti risparmio',
    'Savings account IBAN': 'IBAN conto risparmio',
    'No savings accounts added.': 'Nessun conto risparmio aggiunto.',
    'In': 'Entrate',
    'Out': 'Uscite',
    'Direction': 'Direzione',
    'Expenses': 'Spese',
    'Income': 'Entrate',
    'Savings': 'Risparmio',
    'Expenses Transactions': 'Transazioni spese',
    'Income Transactions': 'Transazioni entrate',
    'Savings Net (Configured accounts)': 'Risparmio netto (conti configurati)',
    'Savings Flow': 'Flusso risparmio',
    'Savings In': 'Entrate risparmio',
    'Savings Out': 'Uscite risparmio',
    'Total': 'Totale',
    'Unknown error': 'Errore sconosciuto',
    'Please login to save account data.': 'Accedi per salvare i dati account.',
    'Authentication failed.': 'Autenticazione fallita.',
    'Email/Username is required.': 'Email/Nome utente obbligatorio.',
    'Password is required.': 'Password obbligatoria.',
    'This Email/Username is already used.': 'Questo Email/Nome utente e gia usato.',
    'Password should have at least 8 characters': 'La password deve avere almeno 8 caratteri',
    'Invalid Email/Username or Password.': 'Email/Nome utente o password non validi.',
    'Signed out. Running in anonymous local mode.': 'Disconnesso. Modalita anonima locale attiva.',
    'Signed out from user account.': 'Disconnesso dall account utente.',
    'Logout failed.': 'Disconnessione fallita.',
    'WARNING! You will lose all changes made to transaction categories!\nReset Categories to initial/default values?': 'ATTENZIONE! Perderai tutte le modifiche alle categorie delle transazioni!\nRipristinare le categorie ai valori predefiniti?',
    'Please login to reset categories in account mode.': 'Accedi per ripristinare le categorie in modalita account.',
    'Categories reset to default values.': 'Categorie ripristinate ai valori predefiniti.',
    'Reset failed.': 'Ripristino fallito.',
    'Reload failed.': 'Ricarica fallita.',
    'Save settings failed.': 'Salvataggio impostazioni fallito.',
    'Failed to load account data.': 'Caricamento dati account fallito.',
    'Please login first to use User Account mode.': 'Accedi prima per usare la modalita account utente.',
    'Works immediately with no account. Categories and overrides are saved only in this browser/device using local storage.': 'Funziona subito senza account. Categorie e override sono salvati localmente in questo browser/dispositivo.',
    'Sign in to store categories and merchant/type overrides per account in the database, synced across sessions.': 'Accedi per salvare categorie e override esercente/tipo per account nel database, sincronizzati tra sessioni.',
    'Automatically turn any account statement into an interactive financial dashboard with full control for organizing, filtering, and interpreting transactions, a clear Income vs. Expenses balance, plus configurable savings details.': 'Trasforma automaticamente qualsiasi estratto conto in una dashboard finanziaria interattiva con controllo completo per organizzare, filtrare e interpretare le transazioni, un chiaro bilancio Entrate vs Spese e dettagli risparmio configurabili.',
    'V1.1 - Anonymous mode uses local cache. Signed-in mode stores categories and overrides per account.': 'V1.1 - La modalita anonima usa cache locale. La modalita autenticata salva categorie e override per account.',
    'Upload a statement to see your dashboard.': 'Carica un estratto per vedere la dashboard.',
    'No transactions found for this view.': 'Nessuna transazione trovata per questa vista.',
    'Set category per merchant + type': 'Imposta categoria per esercente + tipo',
    'Set category only for this transaction': 'Imposta categoria solo per questa transazione',
    'Merchant + Type: changing one row applies category to all transactions with same Merchant and Type.': 'Esercente + Tipo: cambiare una riga applica la categoria a tutte le transazioni con stesso esercente e tipo.',
    'Single Transaction: changing one row applies category only to that exact transaction.': 'Transazione singola: cambiare una riga applica la categoria solo a quella transazione.',
    'Changing one row applies category to all transactions with same Merchant and Type.': 'Cambiare una riga applica la categoria a tutte le transazioni con stesso esercente e tipo.',
    'Changing one row applies category only to that exact transaction.': 'Cambiare una riga applica la categoria solo a quella transazione.',
    'Full transaction details included': 'Dettagli completi transazione inclusi',
    'Done. Dashboard reloaded successfully.': 'Fatto. Dashboard ricaricata con successo.',
    'Net': 'Netto',
  },
  de: {
    'Mode Selection': 'Modusauswahl',
    'Anonymous': 'Anonym',
    'User Account': 'Benutzerkonto',
    'Dashboard': 'Dashboard',
    'User Login': 'Benutzeranmeldung',
    'Checking session...': 'Sitzung wird gepruft...',
    'Signed in: ': 'Angemeldet: ',
    'Logout': 'Abmelden',
    'Login / Register': 'Anmelden / Registrieren',
    'Email / Username': 'E-Mail / Benutzername',
    'Password': 'Passwort',
    'Show password': 'Passwort anzeigen',
    'Hide password': 'Passwort ausblenden',
    'Login': 'Anmelden',
    'Register': 'Registrieren',
    'Loading...': 'Laden...',
    'Applying selected language...': 'Ausgewahlte Sprache wird angewendet...',
    'Continue as Anonymous': 'Als Anonym fortfahren',
    'Continue with User Account': 'Mit Benutzerkonto fortfahren',
    'Login Required for Account Mode': 'Anmeldung fur Kontomodus erforderlich',
    'Import Bank Statement': 'Kontoauszug importieren',
    'Building dashboard...': 'Dashboard wird erstellt...',
    'Reload View': 'Ansicht neu laden',
    'Close notification': 'Benachrichtigung schliessen',
    'Account Statement Details': 'Kontoauszugsdetails',
    'Account Holder': 'Kontoinhaber',
    'Account Number': 'Kontonummer',
    'Account Type': 'Kontotyp',
    'Statement Period': 'Auszugszeitraum',
    'Categories': 'Kategorien',
    'Expenses (debits)': 'Ausgaben (Belastungen)',
    'Income (credits)': 'Einnahmen (Gutschriften)',
    'All': 'Alle',
    'All categories': 'Alle Kategorien',
    'Add/Remove/Edit Category': 'Kategorie hinzufugen/entfernen/bearbeiten',
    'Reset Categories to initial/default name values': 'Kategorien auf Standardwerte zurucksetzen',
    'Legend': 'Legende',
    'No category data for current filters.': 'Keine Kategoriedaten fur aktuelle Filter.',
    'Top Merchants': 'Top Handler',
    'Search merchant / type...': 'Handler / Typ suchen...',
    'No merchant data.': 'Keine Handlerdaten.',
    'Balance Overview': 'Saldo-Ubersicht',
    'Net difference:': 'Nettodifferenz:',
    'Savings net:': 'Netto-Ersparnis:',
    'Add savings account': 'Sparkonto hinzufugen',
    'Transactions': 'Transaktionen',
    'Hover any row to see full transaction details from the PDF.': 'Bewege den Mauszeiger uber eine Zeile, um alle Details aus dem PDF zu sehen.',
    'Filter table...': 'Tabelle filtern...',
    'All columns': 'Alle Spalten',
    'Date': 'Datum',
    'Merchant': 'Handler',
    'Type': 'Typ',
    'Category': 'Kategorie',
    'Amount': 'Betrag',
    'Save category for:': 'Kategorie speichern fur:',
    'Merchant + Type': 'Handler + Typ',
    'Single Transaction': 'Einzeltransaktion',
    'Amount Sum': 'Betragssumme',
    'Export CSV (filtered)': 'CSV exportieren (gefiltert)',
    'Add / Edit category': 'Kategorie hinzufugen / bearbeiten',
    'New category name...': 'Neuer Kategoriename...',
    'Add': 'Hinzufugen',
    'Select a category...': 'Kategorie auswahlen...',
    'Rename': 'Umbenennen',
    'Delete': 'Loschen',
    'Save': 'Speichern',
    'Cancel': 'Abbrechen',
    'Savings Accounts': 'Sparkonten',
    'Savings account IBAN': 'IBAN Sparkonto',
    'No savings accounts added.': 'Keine Sparkonten hinzugefugt.',
    'In': 'Eingange',
    'Out': 'Ausgange',
    'Direction': 'Richtung',
    'Expenses': 'Ausgaben',
    'Income': 'Einnahmen',
    'Savings': 'Ersparnisse',
    'Expenses Transactions': 'Ausgaben-Transaktionen',
    'Income Transactions': 'Einnahmen-Transaktionen',
    'Savings Net (Configured accounts)': 'Netto-Ersparnis (konfigurierte Konten)',
    'Savings Flow': 'Sparfluss',
    'Savings In': 'Sparen Eingang',
    'Savings Out': 'Sparen Ausgang',
    'Total': 'Gesamt',
    'Unknown error': 'Unbekannter Fehler',
    'Please login to save account data.': 'Bitte anmelden, um Kontodaten zu speichern.',
    'Authentication failed.': 'Authentifizierung fehlgeschlagen.',
    'Email/Username is required.': 'E-Mail/Benutzername ist erforderlich.',
    'Password is required.': 'Passwort ist erforderlich.',
    'This Email/Username is already used.': 'Diese E-Mail/dieser Benutzername wird bereits verwendet.',
    'Password should have at least 8 characters': 'Das Passwort muss mindestens 8 Zeichen haben',
    'Invalid Email/Username or Password.': 'Ungultige E-Mail/Benutzername oder Passwort.',
    'Signed out. Running in anonymous local mode.': 'Abgemeldet. Anonymer lokaler Modus aktiv.',
    'Signed out from user account.': 'Vom Benutzerkonto abgemeldet.',
    'Logout failed.': 'Abmeldung fehlgeschlagen.',
    'WARNING! You will lose all changes made to transaction categories!\nReset Categories to initial/default values?': 'WARNUNG! Sie verlieren alle Anderungen an Transaktionskategorien!\nKategorien auf Standardwerte zurucksetzen?',
    'Please login to reset categories in account mode.': 'Bitte anmelden, um Kategorien im Kontomodus zuruckzusetzen.',
    'Categories reset to default values.': 'Kategorien auf Standardwerte zuruckgesetzt.',
    'Reset failed.': 'Zurucksetzen fehlgeschlagen.',
    'Reload failed.': 'Neu laden fehlgeschlagen.',
    'Save settings failed.': 'Speichern der Einstellungen fehlgeschlagen.',
    'Failed to load account data.': 'Laden der Kontodaten fehlgeschlagen.',
    'Please login first to use User Account mode.': 'Bitte zuerst anmelden, um den Benutzerkontomodus zu verwenden.',
    'Works immediately with no account. Categories and overrides are saved only in this browser/device using local storage.': 'Funktioniert sofort ohne Konto. Kategorien und Overrides werden nur in diesem Browser/Gerat lokal gespeichert.',
    'Sign in to store categories and merchant/type overrides per account in the database, synced across sessions.': 'Anmelden, um Kategorien und Handler/Typ-Overrides pro Konto in der Datenbank zu speichern, synchronisiert uber Sitzungen.',
    'Automatically turn any account statement into an interactive financial dashboard with full control for organizing, filtering, and interpreting transactions, a clear Income vs. Expenses balance, plus configurable savings details.': 'Wandle jeden Kontoauszug automatisch in ein interaktives Finanz-Dashboard um, mit voller Kontrolle zum Organisieren, Filtern und Interpretieren von Transaktionen, klarer Einnahmen-vs-Ausgaben-Bilanz und konfigurierbaren Spar-Details.',
    'V1.1 - Anonymous mode uses local cache. Signed-in mode stores categories and overrides per account.': 'V1.1 - Der anonyme Modus nutzt lokalen Cache. Der angemeldete Modus speichert Kategorien und Overrides pro Konto.',
    'Upload a statement to see your dashboard.': 'Laden Sie einen Auszug hoch, um Ihr Dashboard zu sehen.',
    'No transactions found for this view.': 'Keine Transaktionen fur diese Ansicht gefunden.',
    'Set category per merchant + type': 'Kategorie pro Handler + Typ festlegen',
    'Set category only for this transaction': 'Kategorie nur fur diese Transaktion festlegen',
    'Merchant + Type: changing one row applies category to all transactions with same Merchant and Type.': 'Handler + Typ: Das Andern einer Zeile setzt die Kategorie fur alle Transaktionen mit gleichem Handler und Typ.',
    'Single Transaction: changing one row applies category only to that exact transaction.': 'Einzeltransaktion: Das Andern einer Zeile setzt die Kategorie nur fur diese Transaktion.',
    'Changing one row applies category to all transactions with same Merchant and Type.': 'Das Andern einer Zeile setzt die Kategorie fur alle Transaktionen mit gleichem Handler und Typ.',
    'Changing one row applies category only to that exact transaction.': 'Das Andern einer Zeile setzt die Kategorie nur fur diese Transaktion.',
    'Full transaction details included': 'Vollstandige Transaktionsdetails enthalten',
    'Done. Dashboard reloaded successfully.': 'Fertig. Dashboard erfolgreich neu geladen.',
    'Net': 'Netto',
  },
}

function translateDynamic(language: NonPrimaryLanguage, en: string): string | null {
  if (language === 'fr') {
    const userAccount = /^User Account \((.+)\)$/.exec(en)
    if (userAccount) return `Compte utilisateur (${userAccount[1]})`

    const doneProcessed = /^Done\. "(.+)" processed in ([0-9]+(?:\.[0-9]+)?)s \(([0-9]+) transactions\)\.$/.exec(en)
    if (doneProcessed) return `Termine. "${doneProcessed[1]}" traite en ${doneProcessed[2]}s (${doneProcessed[3]} transactions).`
  }

  if (language === 'it') {
    const userAccount = /^User Account \((.+)\)$/.exec(en)
    if (userAccount) return `Account utente (${userAccount[1]})`

    const doneProcessed = /^Done\. "(.+)" processed in ([0-9]+(?:\.[0-9]+)?)s \(([0-9]+) transactions\)\.$/.exec(en)
    if (doneProcessed) return `Fatto. "${doneProcessed[1]}" elaborato in ${doneProcessed[2]}s (${doneProcessed[3]} transazioni).`
  }

  if (language === 'de') {
    const userAccount = /^User Account \((.+)\)$/.exec(en)
    if (userAccount) return `Benutzerkonto (${userAccount[1]})`

    const doneProcessed = /^Done\. "(.+)" processed in ([0-9]+(?:\.[0-9]+)?)s \(([0-9]+) transactions\)\.$/.exec(en)
    if (doneProcessed) return `Fertig. "${doneProcessed[1]}" in ${doneProcessed[2]}s verarbeitet (${doneProcessed[3]} Transaktionen).`
  }

  return null
}

export function translate(language: Language, ro: string, en: string): string {
  if (language === 'ro') return ro
  if (language === 'en') return en

  const staticHit = TRANSLATIONS[language][en]
  if (staticHit) return staticHit

  const dynamicHit = translateDynamic(language, en)
  if (dynamicHit) return dynamicHit

  // Hard fallback to keep UI readable if a future string is not cataloged yet.
  return en
}

const KEY_TEXTS = {
  'k_account_holder': { ro: 'Titular cont', en: 'Account Holder' },
  'k_account_number': { ro: 'Numar cont', en: 'Account Number' },
  'k_account_statement_details': { ro: 'Detalii extras de cont', en: 'Account Statement Details' },
  'k_account_type': { ro: 'Tip cont', en: 'Account Type' },
  'k_add': { ro: 'Adauga', en: 'Add' },
  'k_add_edit_category': { ro: 'Adauga / Editeaza categorie', en: 'Add / Edit category' },
  'k_add_remove_edit_category': { ro: 'Adauga/Sterge/Editeaza categoria', en: 'Add/Remove/Edit Category' },
  'k_add_savings_account': { ro: 'Adauga cont de economii', en: 'Add savings account' },
  'k_all': { ro: 'Toate', en: 'All' },
  'k_all_categories': { ro: 'Toate categoriile', en: 'All categories' },
  'k_all_columns': { ro: 'Toate coloanele', en: 'All columns' },
  'k_amount': { ro: 'Suma', en: 'Amount' },
  'k_amount_sum': { ro: 'Suma totala', en: 'Amount Sum' },
  'k_anonymous': { ro: 'Anonim', en: 'Anonymous' },
  'k_applying_selected_language': { ro: 'Se aplica limba selectata...', en: 'Applying selected language...' },
  'k_authentication_failed': { ro: 'Autentificarea a esuat.', en: 'Authentication failed.' },
  'k_balance_overview': { ro: 'Sumar Balanta', en: 'Balance Overview' },
  'k_building_dashboard': { ro: 'Creare dashboard...', en: 'Building dashboard...' },
  'k_cancel': { ro: 'Anuleaza', en: 'Cancel' },
  'k_categories': { ro: 'Categorii', en: 'Categories' },
  'k_categories_reset_to_default_values': { ro: 'Categoriile au fost resetate la valorile implicite.', en: 'Categories reset to default values.' },
  'k_category': { ro: 'Categorie', en: 'Category' },
  'k_checking_session': { ro: 'Verific sesiunea...', en: 'Checking session...' },
  'k_clear_filter': { ro: 'Sterge filtrul', en: 'Clear filter' },
  'k_close_notification': { ro: 'Inchide notificarea', en: 'Close notification' },
  'k_continue_as_anonymous': { ro: 'Continua ca Anonim', en: 'Continue as Anonymous' },
  'k_continue_with_user_account': { ro: 'Continua cu Cont Utilizator', en: 'Continue with User Account' },
  'k_cookie_banner_title': { ro: 'Setari cookie', en: 'Cookie Settings' },
  'k_cookie_banner_description': { ro: 'Folosim cookie-uri si stocare locala pentru functionarea site-ului si, optional, pentru a salva preferintele si cache-ul dashboard-ului pe acest dispozitiv. Poti accepta toate, respinge optionalele sau personaliza alegerea.', en: 'We use cookies and browser storage for site operation and, optionally, to save preferences and dashboard cache on this device. You can accept all, reject optional cookies, or customize your choice.' },
  'k_cookie_accept_all': { ro: 'Accept tot', en: 'Accept all' },
  'k_cookie_reject_optional': { ro: 'Respinge optionalele', en: 'Reject optional' },
  'k_cookie_customize': { ro: 'Personalizeaza', en: 'Customize' },
  'k_cookie_settings': { ro: 'Cookie-uri', en: 'Cookies' },
  'k_cookie_modal_title': { ro: 'Preferinte cookie', en: 'Cookie Preferences' },
  'k_cookie_modal_description': { ro: 'Controleaza ce categorii optionale de cookie-uri si stocare in browser permiti. Cookie-urile strict necesare raman active.', en: 'Control which optional cookie and browser storage categories you allow. Strictly necessary cookies remain active.' },
  'k_cookie_necessary': { ro: 'Strict necesare', en: 'Strictly necessary' },
  'k_cookie_necessary_description': { ro: 'Necesare pentru autentificare, securitate si functionarea de baza a aplicatiei.', en: 'Required for authentication, security, and core app functionality.' },
  'k_cookie_always_active': { ro: 'Mereu active', en: 'Always active' },
  'k_cookie_preferences': { ro: 'Preferinte', en: 'Preferences' },
  'k_cookie_preferences_description': { ro: 'Salveaza local limba, categorii si override-uri (mod anonim) pe acest dispozitiv.', en: 'Stores language, categories, and overrides locally (anonymous mode) on this device.' },
  'k_cookie_performance': { ro: 'Performanta / cache vizualizare', en: 'Performance / view cache' },
  'k_cookie_performance_description': { ro: 'Pastreaza in sesiune cache-ul dashboard-ului pentru reincarcari rapide in acest browser.', en: 'Keeps dashboard cache in session storage for faster reloads in this browser.' },
  'k_cookie_save_selection': { ro: 'Salveaza selectia', en: 'Save selection' },
  'k_or_continue_with': { ro: 'Sau continua cu', en: 'Or continue with' },
  'k_social_continue_with_google': { ro: 'Continua cu Google', en: 'Continue with Google' },
  'k_social_continue_with_facebook': { ro: 'Continua cu Facebook', en: 'Continue with Facebook' },
  'k_social_continue_with_apple': { ro: 'Continua cu Apple', en: 'Continue with Apple' },
  'k_oauth_provider_denied': { ro: 'Autentificarea a fost anulata de provider.', en: 'Sign-in was cancelled by the provider.' },
  'k_oauth_invalid_state': { ro: 'Sesiunea de autentificare sociala a expirat sau este invalida. Incearca din nou.', en: 'Social sign-in session expired or is invalid. Please try again.' },
  'k_oauth_missing_code': { ro: 'Providerul nu a returnat codul de autentificare.', en: 'The provider did not return an authorization code.' },
  'k_oauth_failed': { ro: 'Autentificarea sociala a esuat.', en: 'Social sign-in failed.' },
  'k_oauth_provider_not_configured': { ro: 'Acest provider social nu este configurat inca.', en: 'This social provider is not configured yet.' },
  'k_email_verification_code_sent': { ro: 'Codul de verificare a fost trimis pe email. Verifica inbox-ul (sau backend logs in development).', en: 'Verification code was sent by email. Check your inbox (or backend logs in development).' },
  'k_email_verification_enter_pin_prompt': { ro: 'Introdu codul PIN de 6 cifre trimis la:', en: 'Enter the 6-digit PIN sent to:' },
  'k_email_verification_code_placeholder': { ro: 'Cod PIN (6 cifre)', en: 'PIN code (6 digits)' },
  'k_verify_email_code': { ro: 'Verifica email', en: 'Verify email' },
  'k_email_verification_code_must_have_6_digits': { ro: 'Codul de verificare trebuie sa aiba 6 cifre.', en: 'Verification code must have 6 digits.' },
  'k_email_verification_failed': { ro: 'Verificarea emailului a esuat.', en: 'Email verification failed.' },
  'k_dashboard': { ro: 'Dashboard', en: 'Dashboard' },
  'k_date': { ro: 'Data', en: 'Date' },
  'k_delete': { ro: 'Sterge', en: 'Delete' },
  'k_direction': { ro: 'Directie', en: 'Direction' },
  'k_done_dashboard_reloaded_successfully': { ro: 'Gata. Dashboard-ul a fost reincarcat cu succes.', en: 'Done. Dashboard reloaded successfully.' },
  'k_done_statement_processed': { ro: 'Gata. "{file}" procesat in {duration}s ({count} tranzactii).', en: 'Done. "{file}" processed in {duration}s ({count} transactions).' },
  'k_email_username': { ro: 'Email / Utilizator', en: 'Email / Username' },
  'k_email_username_is_required': { ro: 'Email/Utilizator este obligatoriu.', en: 'Email/Username is required.' },
  'k_expenses': { ro: 'Cheltuieli', en: 'Expenses' },
  'k_expenses_debits': { ro: 'Cheltuieli (debit)', en: 'Expenses (debits)' },
  'k_expenses_transactions': { ro: 'Tranzactii cheltuieli', en: 'Expenses Transactions' },
  'k_export_csv': { ro: 'Export CSV', en: 'Export CSV' },
  'k_export_csv_filtered': { ro: 'Export CSV (filtrat)', en: 'Export CSV (filtered)' },
  'k_failed_to_load_account_data': { ro: 'Incarcarea datelor contului a esuat.', en: 'Failed to load account data.' },
  'k_filter_table': { ro: 'Filtreaza tabelul...', en: 'Filter table...' },
  'k_full_transaction_details_included': { ro: 'Sunt incluse si detaliile complete ale tranzactiei', en: 'Full transaction details included' },
  'k_hide_password': { ro: 'Ascunde parola', en: 'Hide password' },
  'k_hover_any_row_to_see_full_transaction_details_from_the_pdf': { ro: 'Treci cu mouse-ul peste un rand pentru detaliile complete din PDF.', en: 'Hover any row to see full transaction details from the PDF.' },
  'k_import_bank_statement': { ro: 'Importa extras bancar', en: 'Import Bank Statement' },
  'k_in': { ro: 'Intrari', en: 'In' },
  'k_income': { ro: 'Venituri', en: 'Income' },
  'k_income_credits': { ro: 'Venituri (credit)', en: 'Income (credits)' },
  'k_income_transactions': { ro: 'Tranzactii venituri', en: 'Income Transactions' },
  'k_invalid_email_username_or_password': { ro: 'Email/Utilizator sau parola invalide.', en: 'Invalid Email/Username or Password.' },
  'k_legend': { ro: 'Legenda', en: 'Legend' },
  'k_loading': { ro: 'Incarcare...', en: 'Loading...' },
  'k_login': { ro: 'Autentificare', en: 'Login' },
  'k_login_register': { ro: 'Login / Inregistrare', en: 'Login / Register' },
  'k_login_required_for_account_mode': { ro: 'Login necesar pentru modul de cont', en: 'Login Required for Account Mode' },
  'k_logout': { ro: 'Deconectare', en: 'Logout' },
  'k_logout_failed': { ro: 'Deconectarea a esuat.', en: 'Logout failed.' },
  'k_merchant': { ro: 'Comerciant', en: 'Merchant' },
  'k_merchant_type': { ro: 'Comerciant + Tip', en: 'Merchant + Type' },
  'k_mode_selection': { ro: 'Selectare Mod', en: 'Mode Selection' },
  'k_net': { ro: 'Net', en: 'Net' },
  'k_net_difference': { ro: 'Diferenta neta:', en: 'Net difference:' },
  'k_new_category_name': { ro: 'Nume categorie noua...', en: 'New category name...' },
  'k_no_category_data_for_current_filters': { ro: 'Nu exista date de categorii pentru filtrele curente.', en: 'No category data for current filters.' },
  'k_no_merchant_data': { ro: 'Nu exista date pentru comercianti.', en: 'No merchant data.' },
  'k_no_savings_accounts_added': { ro: 'Nu exista conturi de economii adaugate.', en: 'No savings accounts added.' },
  'k_no_transactions_found_for_this_view': { ro: 'Nu exista tranzactii pentru aceasta vizualizare.', en: 'No transactions found for this view.' },
  'k_out': { ro: 'Iesiri', en: 'Out' },
  'k_password': { ro: 'Parola', en: 'Password' },
  'k_password_is_required': { ro: 'Parola este obligatorie.', en: 'Password is required.' },
  'k_password_should_have_at_least_8_characters': { ro: 'Parola trebuie sa aiba cel putin 8 caractere.', en: 'Password should have at least 8 characters' },
  'k_please_login_first_to_use_user_account_mode': { ro: 'Autentifica-te mai intai pentru a folosi modul Cont Utilizator.', en: 'Please login first to use User Account mode.' },
  'k_please_login_to_reset_categories_in_account_mode': { ro: 'Autentifica-te pentru a reseta categoriile in modul Cont Utilizator.', en: 'Please login to reset categories in account mode.' },
  'k_please_login_to_save_account_data': { ro: 'Autentifica-te pentru a salva datele contului.', en: 'Please login to save account data.' },
  'k_register': { ro: 'Inregistrare', en: 'Register' },
  'k_reload_failed': { ro: 'Reincarcarea a esuat.', en: 'Reload failed.' },
  'k_reload_view': { ro: 'Reincarca vizualizarea', en: 'Reload View' },
  'k_rename': { ro: 'Redenumeste', en: 'Rename' },
  'k_reset_categories_to_initial_default_name_values': { ro: 'Reseteaza categoriile la valorile implicite', en: 'Reset Categories to initial/default name values' },
  'k_reset_categories_warning_confirm': { ro: 'ATENTIE! Vei pierde toate modificarile pe care le-ai facut legate de categoriile tranzactiilor!\nResetezi categoriile la valorile initiale/implicite?', en: 'WARNING! You will lose all changes made to transaction categories!\nReset Categories to initial/default values?' },
  'k_reset_failed': { ro: 'Resetarea a esuat.', en: 'Reset failed.' },
  'k_save': { ro: 'Salveaza', en: 'Save' },
  'k_save_category_for': { ro: 'Salveaza categoria pentru:', en: 'Save category for:' },
  'k_save_settings_failed': { ro: 'Salvarea setarilor a esuat.', en: 'Save settings failed.' },
  'k_savings': { ro: 'Economii', en: 'Savings' },
  'k_savings_account_iban': { ro: 'IBAN cont economii', en: 'Savings account IBAN' },
  'k_savings_accounts': { ro: 'Conturi de economii', en: 'Savings Accounts' },
  'k_savings_flow': { ro: 'Flux economii', en: 'Savings Flow' },
  'k_savings_in': { ro: 'Intrari economii', en: 'Savings In' },
  'k_savings_net': { ro: 'Economii nete:', en: 'Savings net:' },
  'k_savings_net_configured_accounts': { ro: 'Economii nete (conturi configurate)', en: 'Savings Net (Configured accounts)' },
  'k_savings_out': { ro: 'Iesiri economii', en: 'Savings Out' },
  'k_search_merchant_type': { ro: 'Cauta comerciant / tip...', en: 'Search merchant / type...' },
  'k_rows_per_page': { ro: 'Tranzactii / pagina', en: 'Transactions / page' },
  'k_no_rows': { ro: 'Fara randuri', en: 'No rows' },
  'k_showing_range_of_total': { ro: 'Afisare {from}-{to} din {total}', en: 'Showing {from}-{to} of {total}' },
  'k_select_a_category': { ro: 'Selecteaza o categorie...', en: 'Select a category...' },
  'k_set_category_only_for_this_transaction': { ro: 'Seteaza categoria doar pentru aceasta tranzactie', en: 'Set category only for this transaction' },
  'k_set_category_per_merchant_type': { ro: 'Seteaza categoria per comerciant + tip', en: 'Set category per merchant + type' },
  'k_show_password': { ro: 'Arata parola', en: 'Show password' },
  'k_signed_in': { ro: 'Conectat: ', en: 'Signed in: ' },
  'k_signed_out_from_user_account': { ro: 'Deconectat din contul de utilizator.', en: 'Signed out from user account.' },
  'k_signed_out_running_in_anonymous_local_mode': { ro: 'Deconectat. Ruleaza in modul anonim local.', en: 'Signed out. Running in anonymous local mode.' },
  'k_single_transaction': { ro: 'Tranzactie individuala', en: 'Single Transaction' },
  'k_statement_period': { ro: 'Perioada extras', en: 'Statement Period' },
  'k_this_email_username_is_already_used': { ro: 'Acest Email/Utilizator este deja folosit.', en: 'This Email/Username is already used.' },
  'k_top_merchants': { ro: 'Top Comercianti', en: 'Top Merchants' },
  'k_total': { ro: 'Total', en: 'Total' },
  'k_transactions': { ro: 'Tranzactii', en: 'Transactions' },
  'k_type': { ro: 'Tip', en: 'Type' },
  'k_unknown_error': { ro: 'Eroare necunoscuta', en: 'Unknown error' },
  'k_upload_a_statement_to_see_your_dashboard': { ro: 'Incarca un extras pentru a vedea dashboard-ul.', en: 'Upload a statement to see your dashboard.' },
  'k_app_description': { ro: 'Transforma automat orice extras de cont intr-un dashboard financiar interactiv ce ofera control complet pentru organizarea, filtrarea si interpretarea tranzactiilor, o balanta clara Venituri vs. Cheltuieli, plus posibilitatea de a include si configura detalii legate de economii.', en: 'Automatically turn any account statement into an interactive financial dashboard with full control for organizing, filtering, and interpreting transactions, a clear Income vs. Expenses balance, plus configurable savings details.' },
  'k_mode_anonymous_description': { ro: 'Functioneaza imediat fara cont. Categoriile si override-urile se salveaza local, doar in acest browser/dispozitiv.', en: 'Works immediately with no account. Categories and overrides are saved only in this browser/device using local storage.' },
  'k_mode_account_description': { ro: 'Autentifica-te pentru a salva categoriile si override-urile per cont in baza de date, sincronizate intre sesiuni.', en: 'Sign in to store categories and merchant/type overrides per account in the database, synced across sessions.' },
  'k_footer_local_vs_account': { ro: 'V1.1 - Modul anonim foloseste cache local. Modul autentificat stocheaza categoriile si override-urile per cont.', en: 'V1.1 - Anonymous mode uses local cache. Signed-in mode stores categories and overrides per account.' },
  'k_user_account': { ro: 'Cont Utilizator', en: 'User Account' },
  'k_user_account_with_name': { ro: 'Cont Utilizator ({user})', en: 'User Account ({user})' },
  'k_user_login': { ro: 'Autentificare utilizator', en: 'User Login' },
  'k_category_change_mode_merchant_type_desc': { ro: 'Comerciant + Tip: schimbarea pe un rand se aplica tuturor tranzactiilor cu acelasi Comerciant si Tip.', en: 'Merchant + Type: changing one row applies category to all transactions with same Merchant and Type.' },
  'k_category_change_mode_single_tx_desc': { ro: 'Tranzactie individuala: schimbarea pe un rand se aplica doar acelei tranzactii.', en: 'Single Transaction: changing one row applies category only to that exact transaction.' },
  'k_category_change_mode_merchant_type_short_desc': { ro: 'Schimbarea pe un rand se aplica tuturor tranzactiilor cu acelasi Comerciant si Tip.', en: 'Changing one row applies category to all transactions with same Merchant and Type.' },
  'k_category_change_mode_single_tx_short_desc': { ro: 'Schimbarea pe un rand se aplica doar acelei tranzactii.', en: 'Changing one row applies category only to that exact transaction.' },
  'k_savings_accounts_modal_help': { ro: 'Toate IBAN-urile adaugate in aceasta lista sunt considerate conturi de economii. Tranzactiile din extras care contin aceste conturi sunt folosite pentru calculul economiilor nete.', en: 'All IBANs added to this list are treated as savings accounts. Transactions from the uploaded statement that contain these accounts are used to calculate the net savings amount.' },
} as const

export function translateKey(language: Language, key: string): string {
  const pair = KEY_TEXTS[key as keyof typeof KEY_TEXTS]
  if (!pair) return key
  return translate(language, pair.ro, pair.en)
}

function formatTemplate(template: string, values?: InterpolationValues): string {
  if (!values) return template
  return template.replace(/\{([a-zA-Z0-9_]+)\}/g, (_, k) => String(values[k] ?? `{${k}}`))
}

export function translateKeyFormat(language: Language, key: string, values?: InterpolationValues): string {
  const pair = KEY_TEXTS[key as keyof typeof KEY_TEXTS]
  if (!pair) return formatTemplate(key, values)
  return translate(language, formatTemplate(pair.ro, values), formatTemplate(pair.en, values))
}

export const LANGUAGE_OPTIONS: Array<{ value: Language; label: string }> = [
  { value: 'en', label: 'English' },
  { value: 'ro', label: 'Romana' },
  { value: 'fr', label: 'Francais' },
  { value: 'it', label: 'Italiano' },
  { value: 'de', label: 'Deutsch' },
]



